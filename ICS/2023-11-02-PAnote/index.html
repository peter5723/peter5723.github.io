
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Peter">
      
      
      
        <link rel="prev" href="../../signal/ch6_ss/">
      
      
        <link rel="next" href="../shell/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.4">
    
    
      
        <title>PA_note - Peter's home</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9c788c91.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7C['Inconsolata']:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"['Inconsolata']"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/riscv.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Peter&#39;s home" class="md-header__button md-logo" aria-label="Peter's home" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Peter's home
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PA_note
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Peter&#39;s home" class="md-nav__button md-logo" aria-label="Peter's home" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Peter's home
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          build a website
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="build a website" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          build a website
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../website/mkdocs/" class="md-nav__link">
        mkdocs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../website/github-pages/" class="md-nav__link">
        jekyll
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          化学
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="化学" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          化学
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chem/thermo/" class="md-nav__link">
        化学热力学中的一些问题
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          信号
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="信号" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          信号
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../signal/2023-11-04-oneside_z_transform/" class="md-nav__link">
        单边z变换
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../signal/DFT/" class="md-nav__link">
        DFT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../signal/stft/" class="md-nav__link">
        短时傅里叶变换
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../signal/ch6_ss/" class="md-nav__link">
        LTI系统频域特性（ss第6章）
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="true">
          计算机系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="计算机系统" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          计算机系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PA 实验记录
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PA 实验记录
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pa0-tools" class="md-nav__link">
    PA0 (tools)
  </a>
  
    <nav class="md-nav" aria-label="PA0 (tools)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    C语言
  </a>
  
    <nav class="md-nav" aria-label="C语言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    作用域和链接
  </a>
  
    <nav class="md-nav" aria-label="作用域和链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    作用域
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    链接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    存储时期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    字符串处理函数：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clash" class="md-nav__link">
    clash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcc" class="md-nav__link">
    gcc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    gdb
  </a>
  
    <nav class="md-nav" aria-label="gdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting" class="md-nav__link">
    Starting:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-and-stopping" class="md-nav__link">
    Running and Stopping:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breakpoint" class="md-nav__link">
    Breakpoint:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution" class="md-nav__link">
    Execution:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-code" class="md-nav__link">
    Examining code:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#display" class="md-nav__link">
    Display
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layout" class="md-nav__link">
    Layout:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#else" class="md-nav__link">
    Else:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    Makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vim" class="md-nav__link">
    vim
  </a>
  
    <nav class="md-nav" aria-label="vim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    杂项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vim_1" class="md-nav__link">
    vim多文件编辑
  </a>
  
    <nav class="md-nav" aria-label="vim多文件编辑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vim-itself" class="md-nav__link">
    vim itself
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nerdtree" class="md-nav__link">
    nerdtree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-introduction" class="md-nav__link">
    Plugin introduction
  </a>
  
    <nav class="md-nav" aria-label="Plugin introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vundle" class="md-nav__link">
    vundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctags" class="md-nav__link">
    ctags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscope" class="md-nav__link">
    cscope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#youcompleteme" class="md-nav__link">
    YouCompleteMe
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    linux
  </a>
  
    <nav class="md-nav" aria-label="linux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmux" class="md-nav__link">
    tmux
  </a>
  
    <nav class="md-nav" aria-label="tmux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    会话
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" class="md-nav__link">
    window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    窗格
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    寻求帮助
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pa1" class="md-nav__link">
    PA1
  </a>
  
    <nav class="md-nav" aria-label="PA1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    框架介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    怎么开机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    题目回答 注意事项
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pa2" class="md-nav__link">
    PA2
  </a>
  
    <nav class="md-nav" aria-label="PA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nemu" class="md-nav__link">
    1. NEMU 中，一条指令是怎么完整执行的
  </a>
  
    <nav class="md-nav" aria-label="1. NEMU 中，一条指令是怎么完整执行的">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    取指
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    译码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pc" class="md-nav__link">
    更新 PC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nemu" class="md-nav__link">
    NEMU 是什么？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-am" class="md-nav__link">
    2. AM 是什么？运行时环境是什么？
  </a>
  
    <nav class="md-nav" aria-label="2. AM 是什么？运行时环境是什么？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    具体实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-am-nemu" class="md-nav__link">
    3. AM 程序怎么构建，怎么在 NEMU 中运行？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-io" class="md-nav__link">
    4. IO 设备
  </a>
  
    <nav class="md-nav" aria-label="4. IO 设备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    声卡
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 杂项
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        shell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vim/" class="md-nav__link">
        vim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../make/" class="md-nav__link">
        GNU Make
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../riscv/" class="md-nav__link">
        RISC-V
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../number/" class="md-nav__link">
        数字与算术
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" tabindex="0" aria-expanded="false">
          算法
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="算法" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          算法
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithm/intro/" class="md-nav__link">
        介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_7_2" tabindex="0" aria-expanded="false">
          搜索
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="搜索" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          搜索
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithm/search/DFS/" class="md-nav__link">
        DFS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" tabindex="0" aria-expanded="false">
          diary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="diary" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          diary
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" >
      
      
      
        <label class="md-nav__link" for="__nav_8_1" tabindex="0" aria-expanded="false">
          one diary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="one diary" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          one diary
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../diary/" class="md-nav__link">
        one one diary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pa0-tools" class="md-nav__link">
    PA0 (tools)
  </a>
  
    <nav class="md-nav" aria-label="PA0 (tools)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    C语言
  </a>
  
    <nav class="md-nav" aria-label="C语言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    作用域和链接
  </a>
  
    <nav class="md-nav" aria-label="作用域和链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    作用域
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    链接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    存储时期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    字符串处理函数：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clash" class="md-nav__link">
    clash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcc" class="md-nav__link">
    gcc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    gdb
  </a>
  
    <nav class="md-nav" aria-label="gdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting" class="md-nav__link">
    Starting:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-and-stopping" class="md-nav__link">
    Running and Stopping:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breakpoint" class="md-nav__link">
    Breakpoint:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution" class="md-nav__link">
    Execution:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-code" class="md-nav__link">
    Examining code:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#display" class="md-nav__link">
    Display
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layout" class="md-nav__link">
    Layout:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#else" class="md-nav__link">
    Else:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    Makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vim" class="md-nav__link">
    vim
  </a>
  
    <nav class="md-nav" aria-label="vim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    杂项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vim_1" class="md-nav__link">
    vim多文件编辑
  </a>
  
    <nav class="md-nav" aria-label="vim多文件编辑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vim-itself" class="md-nav__link">
    vim itself
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nerdtree" class="md-nav__link">
    nerdtree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-introduction" class="md-nav__link">
    Plugin introduction
  </a>
  
    <nav class="md-nav" aria-label="Plugin introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vundle" class="md-nav__link">
    vundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctags" class="md-nav__link">
    ctags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscope" class="md-nav__link">
    cscope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#youcompleteme" class="md-nav__link">
    YouCompleteMe
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    linux
  </a>
  
    <nav class="md-nav" aria-label="linux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmux" class="md-nav__link">
    tmux
  </a>
  
    <nav class="md-nav" aria-label="tmux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    会话
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" class="md-nav__link">
    window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    窗格
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    寻求帮助
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pa1" class="md-nav__link">
    PA1
  </a>
  
    <nav class="md-nav" aria-label="PA1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    框架介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    怎么开机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    题目回答 注意事项
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pa2" class="md-nav__link">
    PA2
  </a>
  
    <nav class="md-nav" aria-label="PA2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nemu" class="md-nav__link">
    1. NEMU 中，一条指令是怎么完整执行的
  </a>
  
    <nav class="md-nav" aria-label="1. NEMU 中，一条指令是怎么完整执行的">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    取指
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    译码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pc" class="md-nav__link">
    更新 PC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nemu" class="md-nav__link">
    NEMU 是什么？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-am" class="md-nav__link">
    2. AM 是什么？运行时环境是什么？
  </a>
  
    <nav class="md-nav" aria-label="2. AM 是什么？运行时环境是什么？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    具体实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-am-nemu" class="md-nav__link">
    3. AM 程序怎么构建，怎么在 NEMU 中运行？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-io" class="md-nav__link">
    4. IO 设备
  </a>
  
    <nav class="md-nav" aria-label="4. IO 设备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    声卡
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 杂项
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1">速查手册<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>本文是Peter的NJU PA的实验手册。只记录一些<strong>东西</strong>，不提供源代码。</p>
<p><a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2023/index.html">课程网址</a>在这里。</p>
<h2 id="pa0-tools">PA0 (tools)<a class="headerlink" href="#pa0-tools" title="Permanent link">&para;</a></h2>
<p>If you have problems in conflicting debs, just use the original source rather than tsinghua or ustc. It wastes a lot of time.</p>
<p>包冲突的解决：直接用ubuntu提供的源即可，不用阿里云或者清华云了。可以保证下载速度的，也不会有冲突。</p>
<p>终于可以输入中文了。好骚的sogou输入法.</p>
<p>先安装一些必要的工具：
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>apt-get install build-essential    # build-essential packages, include binary utilities, gcc, make, and so on
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>apt-get install man                # on-line reference manual
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>apt-get install gcc-doc            # on-line reference manual for gcc
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>apt-get install gdb                # GNU debugger
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>apt-get install git                # revision control system
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>apt-get install libreadline-dev    # a library used later
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>apt-get install libsdl2-dev        # a library used later
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>apt-get install llvm llvm-dev      # llvm project, which contains libraries used later
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>apt-get install vim                # vim
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>apt-get install vim-gtk            # vim-more
</code></pre></div></p>
<h3 id="c">C语言<a class="headerlink" href="#c" title="Permanent link">&para;</a></h3>
<p>沧海遗珠的细节</p>
<h4 id="macro">macro<a class="headerlink" href="#macro" title="Permanent link">&para;</a></h4>
<p>一是讨论一下<code>#include</code>的路径.</p>
<p>若是用<code>&lt;&gt;</code>那么就是在标准目录中寻找文件</p>
<p>若是用<code>""</code>, 就是在当前目录(c文件所在的位置)寻找文件. 写法和linux中目录的写法一致, 比如在上级文件夹下的另一个文件夹, 可以写成<code>#include "../another/hello.h"</code></p>
<p>一般要把函数声明放在头文件中, 这样可以需要这个函数的c文件引用这个头文件就可以使用该函数了.</p>
<p>头文件的内容一般包含: 明显常量, 宏, 函数声明, 结构模板定义和类型定义. </p>
<p>在去年上数据结构课的时候, 碰到过这样的问题, 有多个文件引用<code>list.h</code>,  导致<code>list.h</code>中的结构类型<code>node</code>被重定义的问题. </p>
<p><strong>c语言中,声明可以重复很多次, 但是定义只能有一次</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">a</span><span class="p">();</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">a</span><span class="p">();</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">a</span><span class="p">();</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1">//这样不会报错</span>
</code></pre></div>
<p>怎么解决这个问题呢, 就是用条件编译指令了:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="cp">#ifndef LIST</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="cp">#define LIST</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="o">*</span><span class="n">PtrToNode</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">PtrToNode</span><span class="w"> </span><span class="n">List</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="k">typedef</span><span class="w"> </span><span class="n">PtrToNode</span><span class="w"> </span><span class="n">Position</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="n">List</span><span class="w"> </span><span class="nf">MakeEmpty</span><span class="p">(</span><span class="n">List</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">IsListEmpty</span><span class="p">(</span><span class="n">List</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">IsLast</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="n">List</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">X</span><span class="p">[],</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">Position</span><span class="w"> </span><span class="nf">Find</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">X</span><span class="p">[],</span><span class="n">List</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">Element</span><span class="p">;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">Position</span><span class="w"> </span><span class="n">Next</span><span class="p">;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">};</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="cp">#endif</span>
</code></pre></div>
<p>如上所示<code>ifndef</code>指令保证结构类型只被定义一次. <code>ifndef</code>指令常常用于防止多次包含同一文件, 保证这个文件只被包含一次.</p>
<h4 id="_2">作用域和链接<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<h5 id="_3">作用域<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h5>
<p>一个C变量的作用域可以是代码块作用域/函数原型作用域/文件作用域.</p>
<p>对于一个全局变量来说, 它具有文件作用域, 整个文件都可以使用它</p>
<h5 id="_4">链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h5>
<p>c变量可以有外部链接/内部链接/空链接</p>
<p>对于一个局部变量来说, 它是只有空链接, 由代码块或者函数原型私有, 只有文件作用域的变量才讨论内部还是外部链接.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">giant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">}</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="c1">//main.c</span>
</code></pre></div>
<p><code>giant</code>就具有外部链接, 其他文件都可以使用<code>giant</code>, 只要加上<code>extern</code>关键字:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">giant</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">...</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1">//foo.c</span>
</code></pre></div>
<p>但是<code>dog</code>有<code>static</code>标识, 那么他就是<code>main.c</code>所私有的, 其他文件无法访问. 这里<code>static</code>声明是说该全局变量具有内部链接.</p>
<h5 id="_5">存储时期<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<p><code>static</code>还有一个地方会碰到, 就是声明一个变量是静态存储时期. 一般的变量都是自动存储时期, 作用域结束就释放. 而静态存储时期的变量, 在整个程序执行期间一直存在. 很显然, 不管加不加<code>static</code>, 全局变量都一定是静态变量. 自动变量不初始化, 静态变量缺省地初始化为0.</p>
<h4 id="_6">字符串处理函数：<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p><strong>strtok</strong></p>
<p>用于字符串切割</p>
<p><code>char *strtok(char *str, const char *delim)</code></p>
<ul>
<li><strong>str</strong> -- 要被分解成一组小字符串的字符串。</li>
<li><strong>delim</strong> -- 包含分隔符的 C 字符串。</li>
</ul>
<p>该函数返回被分解的第一个子字符串，如果没有可检索的字符串，则返回一个空指针。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;I    love you   So     much&quot;</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="n">str</span><span class="o">+</span><span class="n">strlen</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="p">}</span>
</code></pre></div>
<p>会输出如下结果</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>I
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>love
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>love
</code></pre></div>
<p>注意:</p>
<ol>
<li>
<p><code>strtok</code>是会改变原字符串的, 在<code>str</code>的第一个被分隔的位置将<code>delim</code>中对应的字符替换成<code>\0</code></p>
</li>
<li>
<p>如果要继续分割当前字符串, <code>a = strtok(NULL, " ");</code>即可, </p>
</li>
</ol>
<p>和<code>b = strtok(str+strlen(token)+1, " ");</code>的效果是一样的, <code>strlen(token)</code>是前面被分割的总长度.</p>
<ol>
<li>没有了, 就这样.</li>
</ol>
<p><strong>strncpy</strong></p>
<p><code>char *strncpy(char *dest, char *src, size_t n)</code></p>
<p>将<code>src</code>赋值到<code>dest</code>, 返回<code>dest</code>的首地址, 最多复制n个字符</p>
<p><strong>sprintf</strong></p>
<p><code>int sprintf(char* dest, char *format_string, ...)</code></p>
<p>将格式化字符串输出到<code>dest</code>中</p>
<p><strong>sscanf</strong></p>
<p><code>int sscanf(const char *src, const char *format, ...)</code></p>
<p>和<code>scanf</code>基本一样, 只是<code>sscanf</code>是从<code>src</code>中读取数据. </p>
<h3 id="clash">clash<a class="headerlink" href="#clash" title="Permanent link">&para;</a></h3>
<p>首先照readme将url改成订阅地址</p>
<p>后面 按提示即可</p>
<p><code>sudo bash start.sh</code></p>
<p><code>source /etc/profile.d/clash.sh</code></p>
<p><code>proxy_on</code> 打开代理</p>
<p><code>proxy_off</code>关闭代理</p>
<p><code>sudo bash shutdown.sh</code>关闭程序</p>
<p>这样弄好以后，再打开系统的代理:</p>
<p>ubuntu桌面版，右上角点击设置，网络，网络代理，手动，然后把http://127.0.0.1和7890</p>
<p>Then you can google and github freely.</p>
<h3 id="gcc">gcc<a class="headerlink" href="#gcc" title="Permanent link">&para;</a></h3>
<p><code>-g</code>  增加调试指令</p>
<p>gcc 可以增加警告，警告视作错误。</p>
<p>gcc 可以只输出宏定义展开，不编译。</p>
<h3 id="gdb">gdb<a class="headerlink" href="#gdb" title="Permanent link">&para;</a></h3>
<h4 id="starting">Starting:<a class="headerlink" href="#starting" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>  gdb
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  gdb &lt;file&gt; ----   open gdb with the file
</code></pre></div>
<h4 id="running-and-stopping">Running and Stopping:<a class="headerlink" href="#running-and-stopping" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>  quit   ----  exit gdb
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  **please run the program before debug...** 
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  run    ----  run the program(&lt;file&gt;)   
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>  run 1 2 3  ---- run program with command-line arguments 1 2 3
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  kill  ---- stop the program
</code></pre></div>
<h4 id="breakpoint">Breakpoint:<a class="headerlink" href="#breakpoint" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>  info break ---- list all breaks 
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  (b)
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  break &lt;func&gt; ---- Set breakpoint at the entry to &lt;func&gt;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  break  \*0x80483c3 ----Set breakpoint at address 0x80483c3
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>  break  9  ---- Set breakpoint at line 9
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>  break main.c:9 if q==0 ---- conditional breakpoint
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  delete     ----     delete all breakpoints
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>  delete 1   ----     delete the breakpoint 1
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>  disable 1   ----    disable the breakpoint 1
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>  enable 1    ----    enable the breakpoint 1
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>  clear &lt;func&gt; ----   Clear any points at the entry to &lt;func&gt;
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>  (w)
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>  watch \*地址    # 当地址所指内容发送变化时断点
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>  watch var    #当var值变化时，断点
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>  watch (condition)    #当条件符合时，断点
</code></pre></div>
<h4 id="execution">Execution:<a class="headerlink" href="#execution" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>  stepi ---- Execute 1 instruction (assemble instruction)
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  stepi 4 ---Execute 4 instruction (assemble instruction)
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>  nexti ---- Execute 1 instruction, but it doesn&#39;t enter the  function and just execute it
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  step ---- Execute one C statement
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  next ---- Execute one C Statement but doesn&#39;t enter the function.
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  c(continue) -- -- execute to the next breakpoint
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>  until 3 ---- continue exec until the breakpoint 3
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>  finish ----   Resume execution until the current function return. 
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>  call &lt;func&gt; ---- call the func and print the return Value
</code></pre></div>
<h4 id="examining-code">Examining code:<a class="headerlink" href="#examining-code" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>  (p)
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  print /d $rax ----  Print contents of %rax in decimal
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>  print /x $rax ----  Print contents of %rax in hex
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>  print /t $rax ----  Print contents of %rax in binary
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>  print /d (int)$rax ---- Print contents of %rax in decimal but it has signs.
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>  Examine:
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>  x/[num][size][format] address
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>  num = number of objects todisplay
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>  size = size of each project (b=byte h=half-word, w=word, g=quad-word) 
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>  (1 word = 4 Byte)
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>  FORMAT = how to display each object (d=decimal, x=hex, o=octal, etc.)
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>  for example:
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>   x/w  $rax
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>   x/2wd 0xbffff890
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>   x/200bc $rdi
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>   x/s   $rsp (a string)
</code></pre></div>
<h4 id="display">Display<a class="headerlink" href="#display" title="Permanent link">&para;</a></h4>
<p>Compared with <code>examine</code>, If we use display, the value will be printed each time the code is stopped, which is very convenient.
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>  info display ---- get all the info of variables
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>  display {var1 var2 var3} ---- print var1 var2 var3 each time.
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  display /i $pc ---- print where is pc at as asm.
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>  delete display (%num) ---- delete all or %numth variable
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>  disable/enable display (%num) ---- disable/enable %numth variable.
</code></pre></div></p>
<h4 id="layout">Layout:<a class="headerlink" href="#layout" title="Permanent link">&para;</a></h4>
<p><strong>use <code>layout</code> to display what you want, like source code .</strong> 
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>  layout regs
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>  layout split ---- asm and src
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>  layout asm
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>  layout src
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>  layout prev
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>  layout next
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>  focus name
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>  (name = cmd|src|asm|regs|next|prev)
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>  refresh
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>  update
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>  &lt;C-l&gt; refresh
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>  &lt;C-x&gt; 1/2 ---- 1/2 window
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>  &lt;c-x&gt; a  ---- abort window
</code></pre></div></p>
<h4 id="else">Else:<a class="headerlink" href="#else" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>  where  ----   Print the current address and stack backtrace
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>  list ---- see which line the code has examined and its contexts.
</code></pre></div>
<h3 id="makefile">Makefile<a class="headerlink" href="#makefile" title="Permanent link">&para;</a></h3>
<h3 id="vim">vim<a class="headerlink" href="#vim" title="Permanent link">&para;</a></h3>
<h4 id="_7">杂项<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>用vim之前先在<code>.vimrc</code>中配置。</p>
<p>与系统剪贴板复制粘贴使用<code>+y</code> and <code>+p</code>.</p>
<p><code>&lt;C-G&gt;</code> 显示文件信息</p>
<p><code>q:</code> 显示历史命令 用<code>&lt;C-G&gt;</code>关闭(实际上和宏有关，有机会展开)</p>
<p><code>%</code> 是找匹配的括号，在复制函数时很有用。</p>
<p>`` 偶然发现可以用这个方便的跳转</p>
<p><code>.</code> 重复上一条指令</p>
<h4 id="vim_1">vim多文件编辑<a class="headerlink" href="#vim_1" title="Permanent link">&para;</a></h4>
<p>怎么使用vim像vscode那样同时编辑多个文件呢？
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$vim txt1 txt2 ---- 打开txt1和txt2
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>$vim -o txt1 txt2 ---- 打开txt1和txt2在同一个水平窗口里面
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>$vim -O txt1 txt2 ---- 打开txt1和txt2在同一个垂直窗口里面
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>&lt;C-w&gt; + w/hjkl ----- 切换窗口
</code></pre></div></p>
<h5 id="vim-itself">vim itself<a class="headerlink" href="#vim-itself" title="Permanent link">&para;</a></h5>
<p>在编辑器内
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>:sp 将窗口水平分割成两个
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>:vsp 将窗口垂直分割成两个
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>:n下一个文件 :N上一个文件
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>:buffers ---- 显示当前所有正在编辑的文件
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>:buffer %n ---- 切换到第n个文件
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>:e txt3 ---- 打开txt3
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>ZZ ---- 保存当前文件更改
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>:wq ---- 保存所有文件更改
</code></pre></div></p>
<h5 id="nerdtree">nerdtree<a class="headerlink" href="#nerdtree" title="Permanent link">&para;</a></h5>
<p>实际上，使用<code>nerdtree</code>插件更为好用</p>
<p>我用<code>F2</code>打开这个插件</p>
<p>打开以后，仍然可以用<code>&lt;C-w&gt; + w/hjkl</code> 在代码窗口和tree窗口切换</p>
<p><code>o</code>在当前窗口打开文件、文件夹</p>
<p><code>t</code>在新tab里打开文件、文件夹（文件夹就是新树了）</p>
<p><code>gt/gT</code>在tab之间切换</p>
<p><code>s</code>垂直打开标签页</p>
<p>（当然，也可以用鼠标点。）</p>
<h4 id="plugin-introduction">Plugin introduction<a class="headerlink" href="#plugin-introduction" title="Permanent link">&para;</a></h4>
<h5 id="vundle">vundle<a class="headerlink" href="#vundle" title="Permanent link">&para;</a></h5>
<p><code>vim +PluginInstall +qall</code></p>
<p>安装新的包。</p>
<h5 id="ctags">ctags<a class="headerlink" href="#ctags" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>&lt;C-]&gt; 跳转到定义处
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>&lt;C-t&gt; 返回
</code></pre></div>
<h5 id="cscope">cscope<a class="headerlink" href="#cscope" title="Permanent link">&para;</a></h5>
<p>我已经配置过：
<code>&lt;C-\&gt; + %ch</code>  等价于:<code>cscope find %ch &lt;name at cursor&gt;</code></p>
<p>于是
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>:cscope find s   # symbol: find all references to the token under cursor
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>:cscope find g   # global: find global definition(s) of the token under cursor
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>:cscope find c   # calls:  find all calls to the function name under cursor
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>:cscope find t   # text:   find all instances of the text under cursor
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>:cscope find e   # egrep:  egrep search for the word under cursor
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>:cscope find f   # file:   open the filename under cursor
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>:cscope find i   # includes: find files that include the filename under cursor
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>:cscope find d   # called: find functions that function under cursor calls
</code></pre></div></p>
<p>在使用 cscope 时，可以输入 <code>:cw</code> 来打开 quickfix 窗口，来显示所有结果出现的位置。
在 quickfix 窗口切换不同的匹配项，可以输入 <code>:cs cn</code> 切换到下一个匹配项，<code>:cs cp</code> 切换到上一个匹配项。
当然，上下左右hjkl也可以。</p>
<h5 id="youcompleteme">YouCompleteMe<a class="headerlink" href="#youcompleteme" title="Permanent link">&para;</a></h5>
<p>very powerful.</p>
<p>在.vimrc中配置, 配置去网上抄. c语言要装clang先.</p>
<p>个人配置的备忘: </p>
<p>选择补选项: 一是用上下方向键, 二是用<code>&lt;C-N&gt;</code>和<code>&lt;C-P&gt;</code>, 实际上原本默认是tab键选择的, 但是被我禁用了现在.</p>
<p>按了enter选中后是已经补全了, 但还是会剩下一个框. 不用管它继续编程即可.</p>
<h3 id="linux">linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h3>
<h4 id="shell">shell<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h4>
<p>TODO find grep</p>
<h3 id="tools">tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<h4 id="tmux">tmux<a class="headerlink" href="#tmux" title="Permanent link">&para;</a></h4>
<h5 id="_8">会话<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h5>
<p>tmux可以用来打开多个terminal。</p>
<p>命令行下输入<code>tmux</code>, 打开新会话。</p>
<p><code>tmux new -s &lt;session-name&gt;</code>可以给新会话取名字。</p>
<p><code>tmux info</code> 会话信息</p>
<p>基本操作流程：</p>
<ol>
<li>新建会话<code>tmux new -s my_session</code>。</li>
<li>在 Tmux 窗口运行所需的程序。</li>
<li>按下快捷键Ctrl+b d将会话分离。</li>
<li>下次使用时，重新连接到会话<code>tmux attach-session -t my_session</code>。
当然用<code>tmux a</code>可以快速连接上一个会话。</li>
</ol>
<p>对tmux来说，最重要的快捷键就是<code>&lt;C-b&gt;</code>, 先输入这个，然后输入指令tmux才会响应。
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Ctrl+b d ---- 分离当前会话。
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Ctrl+b s ---- 列出所有会话。
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Ctrl+b $ ---- 重命名当前会话
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>Ctrl+b : ---- 进入命令行模式
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>:kill-server 删除所有会话
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>:kill-session 删除当前会话
</code></pre></div></p>
<h5 id="window">window<a class="headerlink" href="#window" title="Permanent link">&para;</a></h5>
<p>一个会话内，tmux可以包含多个窗口（感觉窗口和会话差不多，不赘述）
似乎还是窗口更方便切换啊。
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>&lt;C-b&gt; c ---- new window
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>&lt;C-b&gt; n ---- next window
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>&lt;C-b&gt; p ---- last window
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>&lt;C-b&gt; %num ---- to %numth window
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>&lt;C-b&gt; , ---- rename window
</code></pre></div></p>
<h5 id="_9">窗格<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h5>
<p>也可以包含多个窗格
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>Ctrl+b %：划分左右两个窗格。
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Ctrl+b &quot;：划分上下两个窗格。
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>Ctrl+b &lt;arrow key&gt;：光标切换到其他窗格。括号表示方向键。
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>Ctrl+b x：删除该窗格
</code></pre></div></p>
<h3 id="_10">寻求帮助<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>Search The Fucking Web(STFW)</p>
<p>Read The Fucking Manual(RTFM)</p>
<p>Read The Fucking Source Code(RTFSC)</p>
<p><del class="critic"> 拽你妈，会写几个程序了不起啊，一天到晚fucking fucking的. </del></p>
<p>这个字体太好看了，不忍心用这个字体骂人。</p>
<h2 id="pa1">PA1<a class="headerlink" href="#pa1" title="Permanent link">&para;</a></h2>
<p>how to run <code>nemu</code>? enter <code>nemu</code> dictionary and <code>make</code> to complile, <code>make run</code> to run, <code>make gdb</code> to use gdb to debug.  </p>
<h3 id="_11">框架介绍<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>TRM - Turing Machine.</p>
<p>存储器是个在<code>nemu/src/memory/paddr.c</code>中定义的大数组.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>static uint8_t pmem[CONFIG_MSIZE] PG_ALIGN = {};
</code></pre></div>
<p>上面的代码定义了<code>pmem</code>,对应128M的存储空间</p>
<p>PC和通用寄存器都在<code>nemu/src/isa/$ISA/include/isa-def.h</code>中的结构体中定义.
寄存器有关的在全局变量<code>cpu</code>中,
包括<code>cpu.pc</code>程序计数器
和<code>cpu.gpr[n]</code>n表示第n个寄存器。</p>
<p><code>nemu/src/cpu/cpu-exec.c</code>中有和指令执行相关的内容
<code>cpu_exec(n)</code>表示执行接下来的n条指令。</p>
<h3 id="_12">怎么开机<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>初始化nemu的代码在<code>monitor.c</code>中定义
前面都是些必要的准备工作，介绍一下<code>init_isa()</code>函数，在<code>nemu/src/isa/$ISA/init.c</code>中定义
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init_isa</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="cm">/* Load built-in image. */</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="n">guest_to_host</span><span class="p">(</span><span class="n">RESET_VECTOR</span><span class="p">),</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">img</span><span class="p">));</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="cm">/* Initialize this virtual computer system. */</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="n">restart</span><span class="p">();</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">}</span>
</code></pre></div></p>
<p>第一项工作就是将一个内置的客户程序读入到内存中.直接就用了<code>memcpy</code>这个函数，明快。
注意：
<code>RESET_VECTOR</code>是存放代码的固定内存地址。由于本次实验采用<code>RISC-V</code>,内存地址不从零开始，所以要用<code>guest_to_host()</code>函数来转换。
它将CPU要访问的内存地址转化成数组pmem中的偏移位置。
<code>init_isa()</code>的第二项任务是初始化寄存器, 这是通过restart()函数来实现的.它设置<code>cpu.pc</code> 的值并将0号寄存器置0.</p>
<h3 id="_13">题目回答 注意事项<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p><strong>在<code>cmd_c()</code>函数中, 调用<code>cpu_exec()</code>的时候传入了参数-1, 你知道这是什么意思吗?</strong>
看函数参数。是<code>uint_32t</code>类型的，是无符号整数。-1被看做无符号数，也就是2的32次方-1，就是运行这么多次。</p>
<p>表达式求值测试这里：</p>
<p><strong>如何过滤除以零的表达式?</strong>
gcc 在编译的时候就会对除以0的表达式发生警报。在编译选项中加入<code>-Werror</code>将警告视作错误即可过滤。</p>
<p><strong>如何获得无符号数的运算结果?</strong>
c语言默认数字是有符号的，在数字后面加<code>u</code>表示无符号数，如<code>12333u</code>。</p>
<p><strong>我加入了逻辑运算通不过测试可能是什么原因？</strong>
注意C语言中， "||" 和 "&amp;&amp;" 是短路操作。你实现了吗？</p>
<p><strong>负号怎么实现?</strong></p>
<p>这里提供思路: 负号的识别看讲义. 负号的计算利用这个特征: 单元运算符只与最近的表达式(只能是括号或者是数字)相结合. 利用这个特点, 我考虑用栈, 若碰到单元运算符, 将之放入栈中. 另外再维护一个栈来记录下与这些单元运算符结合的括号或者数字的位置. 在递归出口时, 若是括号或者数字的情况, 比较该表达式所在位置和先前记录位置, 若相等, 说明栈中的运算符都是属于这个表达式的. 然后将运算符栈清空计算同时位置栈并弹出一个元素. 对了, 注意括号的情况. 有括号时, 将括号也压入栈, 弹出时弹到括号为止. </p>
<p>表述能力有限, 多包涵. 该思路本身有些麻烦, 不过通过了一些测试. 希望有更简单的思路.</p>
<p>做完PA1，你应该已经实现了一个简易的调试器。</p>
<h2 id="pa2">PA2<a class="headerlink" href="#pa2" title="Permanent link">&para;</a></h2>
<p>C 语言库函数源码</p>
<p><a href="https://stackoverflow.com/questions/5233514/where-to-find-stdio-h-functions-implementations">https://stackoverflow.com/questions/5233514/where-to-find-stdio-h-functions-implementations</a></p>
<p>孙燕姿的学会真好听啊，很治愈。</p>
<p>做这个 PA 实验花的时间比预想的久，一个是我学得慢，riscv 看了一天，然后 make 怎么用看了一天，基本上每天只能过一点点进度，一天做显卡，一天做声卡；但是确实很有收获的，之前很少有机会看这么多代码。本来想等做完了再整理，真的快做完了又不知道从哪里开始整理比较好。</p>
<p>PA 2 这个实验花了应该有 100+ 小时吧，陆陆续续写了两个星期了</p>
<p>就以问题为导向好了，不过不会回答讲义上的所有问题。</p>
<h3 id="1-nemu">1. NEMU 中，一条指令是怎么完整执行的<a class="headerlink" href="#1-nemu" title="Permanent link">&para;</a></h3>
<p>好吧，就从这个必答题：一条汇编指令在 NEMU 中的执行过程开始说起。</p>
<p>连学过大计基的人也知道，指令的执行过程是取指、译码、执行，而 NEMU 正是这样的一个模拟器。</p>
<p>首先是开机， <code>nemu/src/monitor/monitor.c</code> 中做了各种初始化的工作</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">init_rand</span><span class="p">();</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">init_mem</span><span class="p">();</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">init_isa</span><span class="p">();</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">load_img</span><span class="p">();</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">IFDEF</span><span class="p">(</span><span class="n">CONFIG_DEVICE</span><span class="p">,</span><span class="w"> </span><span class="n">init_device</span><span class="p">());</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="n">welcome</span><span class="p">();</span>
</code></pre></div>
<p>然后，开始执行你的程序。 执行有关的代码都在 <code>nemu/src/cpu/cpu-exec.c</code> 中。我们一层一层看下去就知道了（用 GDB 调试更清楚）。执行一条指令的函数是 <code>exec_once()</code>，它做了什么呢。
先看一个数据类型吧，看这个 Decode 结构的定义
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Decode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="n">vaddr_t</span><span class="w"> </span><span class="n">pc</span><span class="p">;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="n">vaddr_t</span><span class="w"> </span><span class="n">snpc</span><span class="p">;</span><span class="w"> </span><span class="c1">// static next pc</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="n">vaddr_t</span><span class="w"> </span><span class="n">dnpc</span><span class="p">;</span><span class="w"> </span><span class="c1">// dynamic next pc</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">  </span><span class="n">ISADecodeInfo</span><span class="w"> </span><span class="n">isa</span><span class="p">;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="n">IFDEF</span><span class="p">(</span><span class="n">CONFIG_ITRACE</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">logbuf</span><span class="p">[</span><span class="mi">128</span><span class="p">]);</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="p">}</span><span class="w"> </span><span class="n">Decode</span><span class="p">;</span>
</code></pre></div>
包括 pc（当前指令）snpc 下一条动态指令 dnpc 下一条静态指令</p>
<p>这个结构体存储了 <code>pc</code> 的信息。于是我们就这样更新 cpu.pc 这个程序计数器
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">s</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">s</span><span class="o">-&gt;</span><span class="n">snpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc</span><span class="p">;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">isa_exec_once</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="n">cpu</span><span class="p">.</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">dnpc</span><span class="p">;</span>
</code></pre></div>
然后在 isa_exec_once 中就是具体的 <strong>取指译码执行</strong>操作了。具体的代码在 <code>nemu/src/isa/riscv32/inst.c</code> 中。</p>
<h4 id="_14">取指<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>首先要取指。 <code>s-&gt;pc</code> 存储了当前要执行的指令地址，从这个地址读取指令。具体来说是这样，在NEMU中, 有一个函数<code>inst_fetch()</code>(在<code>nemu/include/cpu/ifetch.h</code>中定义)专门负责取指令的工作. <code>inst_fetch()</code>最终会根据参数len来调用<code>vaddr_ifetch()</code>(在<code>nemu/src/memory/vaddr.c</code>中定义), 而目前<code>vaddr_ifetch()</code>又会通过<code>paddr_read()</code>来访问物理内存中的内容. 因此, 取指操作的本质只不过就是一次内存的访问而已.</p>
<p>另外，isa_exec_once()在调用inst_fetch()的时候传入了s-&gt;snpc的地址, 因此inst_fetch()最后还会根据len（即指令长度）来更新s-&gt;snpc, 从而让s-&gt;snpc指向下一条指令. </p>
<h4 id="_15">译码<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>然后译码。接下来代码会进入decode_exec()函数, 来进行译码。译码，顾名思义就是翻译取出的指令，看对应的操作是什么。</p>
<p>在 NEMU 中，译码是通过模式匹配来实现的。要实现匹配，又定义了一个非常精妙的宏 <code>INSTPAT</code> 来定义。</p>
<p>格式是这样</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>INSTPAT(模式字符串, 指令名称, 指令类型, 指令执行操作);
</code></pre></div>
<p>例子如下</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">INSTPAT_START</span><span class="p">();</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">INSTPAT</span><span class="p">(</span><span class="s">&quot;??????? ????? ????? ??? ????? 00101 11&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">auipc</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">imm</span><span class="p">);</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">INSTPAT</span><span class="p">(</span><span class="s">&quot;0000000 00001 00000 000 00000 11100 11&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ebreak</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">NEMUTRAP</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">(</span><span class="mi">10</span><span class="p">)));</span><span class="w"> </span><span class="c1">// R(10) is $a0</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">INSTPAT</span><span class="p">(</span><span class="s">&quot;??????? ????? ????? ??? ????? ????? ??&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inv</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">INV</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">));</span><span class="w"> </span><span class="c1">// invalid inst</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1">// ...</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">INSTPAT_END</span><span class="p">();</span>
</code></pre></div>
<p>如果你的指令满足某一条匹配规则，那么我们就可以根据这个规则将一串二进制 01 翻译成对应的执行操作了。</p>
<h4 id="_16">执行<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>译码完成了以后，相应的动作都是用 C 语言模拟的，我们执行这些动作就可以了。</p>
<h4 id="pc">更新 PC<a class="headerlink" href="#pc" title="Permanent link">&para;</a></h4>
<p>上面执行完了以后，回到 exec-once 函数， 更新 pc 就结束了。</p>
<p>然后下面的代码，是打印出取到的指令的 16 进制表示及其反汇编结果的；源码很清楚，就不多说了，自己看吧。</p>
<details open="open">
<summary>tips</summary>
<p>宏定义太复杂了，要绕晕了怎么办呢？编译器可以帮助我们。gcc 加 <code>-E</code> 选项可以只打印展开结果而不编译。</p>
<p>有两个宏定义的结构体，展开了就很清晰了：
一个就是存储寄存器和 PC 的情况，还有一个就是用来存储指令的结构体</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">word_t</span><span class="w"> </span><span class="n">gpr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="n">vaddr_t</span><span class="w"> </span><span class="n">pc</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="p">}</span><span class="w"> </span><span class="n">riscv32_CPU_state</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">inst</span><span class="p">;</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="p">}</span><span class="w"> </span><span class="n">riscv32_ISADecodeInfo</span><span class="p">;</span>
</code></pre></div>
</details>
<p>根据 riscv 指令来一条条添加匹配规则，这就是 PA2 的第一部分了。这里就体现了 riscv 的优越性，只需要添加大约 40 条指令就可以通过所有的测试了，这是 x86 想都不敢想的事情。</p>
<p>上面就是一条指令完整的执行结果了。</p>
<h4 id="nemu">NEMU 是什么？<a class="headerlink" href="#nemu" title="Permanent link">&para;</a></h4>
<p>NEMU 是一个模拟器，它模拟了真实计算机的硬件，从执行指令的 CPU 、内存到后面显卡、声卡等外设，都可以被它模拟出来。</p>
<h3 id="2-am">2. AM 是什么？运行时环境是什么？<a class="headerlink" href="#2-am" title="Permanent link">&para;</a></h3>
<p>我写了一个 C 程序，要在 NEMU 上运行，怎么运行呢？我们要为程序提供它需要的运行时环境。运行时环境是一个抽象的概念，可以理解成“程序运行所需的各种需求的满足”。</p>
<p>在上一部分中我们实现了四十多条指令，意味着我们可以进行各种计算了，我们实现了一个“图灵机”。“图灵机”就是最简单的运行时环境：内存，结束运行的方式和运算的指令。</p>
<p>然后呢，如果我的程序的需求更多呢？它不满足于运算，它想要打印，它想要显示，想要接受键盘输入，等等，怎么办？我们要为它提供更丰富的运行时环境。</p>
<p>于是 AM 就应运而生了。AM 是一个为应用程序提供各种运行时环境的库。</p>
<p>AM 将程序运行的需求都收集起来，抽象成了统一的 API，应用程序有需求，直接调用对应的 API 就可以了。</p>
<p>其实，你也可以说，应用程序干嘛非得调库呢？我有需求，我自己码代码实现不可以吗？比如说，我想操控硬件，那我就直接写对硬件读写的代码呗，不行吗？</p>
<p>实际上，当然是可以的。但是，这样不麻烦吗？所以，AM 存在的最大意义就是为了抽象，而抽象是为了简单。我抽象出来，让应用程序不必关注底层的硬件，专注于实现自己的功能就可以了。</p>
<p>所以，原本的软硬件关系是这样的：
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>NEMU -&gt; 应用软件层
</code></pre></div>
NEMU 提供硬件功能；应用软件直接执行，直接和硬件交互</p>
<p>现在增加了一层 AM 抽象层：
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>NEMU -&gt; AM 抽象层 -&gt; 应用软件层
</code></pre></div>
NEMU 提供硬件功能；AM 抽象层负责和上层的软件和底层的硬件进行交互，屏蔽掉交互细节，只提供抽象接口给应用软件层；应用软件层不直接操纵硬件，只和 AM 抽象层进行交互。</p>
<p>AM 中的 API，帮助实现了程序需要的运行时环境，于是将这些 API 称作 abstract machine，这就是 AM 库名称的由来。调用了这些接口的程序，称为 AM 程序。细细理解也是，这些接口实现，很像一个为程序运行提供各种东西的计算机。AM 库包含下面部分：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>AM = TRM + IOE + CTE + VME + MPE
</code></pre></div>
<p>TRM 提供计算功能，IOE 提供输入输出功能，其他的还未涉及。</p>
<h4 id="_17">具体实现<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>运行时环境可以分为架构相关和架构无关。io 就是典型的架构相关的，不同 isa 对应的底层硬件不同，所以对每一种架构都要写一个对应的函数。还有一些库函数是架构无关的，一个实现就可以给所有的架构用了。</p>
<p>实现库函数这里都是苦力活，没什么好说的。就一个 bug 需要提一提，在实现 <code>strcmp</code> 的时候发现的，关于 <code>char</code> 的 bug。</p>
<ol>
<li><code>char</code> 在编译时居然是默认被解释为无符号类型的，即 <code>unsigned char</code>。应该是交叉编译导致的，因为 x86 的下编译是解释为有符号类型的（等待 difftest 验证）。解决方法是使用 <code>int8_t</code> 来明确类型。</li>
<li>8 位无符号数相减得到的却是有符号数，然而结果用 (int) 扩展到 32 位后结果又变成了无符号数。这个特性不管是 x86 还是 riscv 都有。解决方法就是小心一点多做一步强制类型转换。</li>
<li>所以 <code>&lt;stdint.h&gt;</code> 规避了很多歧义，建议使用。</li>
</ol>
<h3 id="3-am-nemu">3. AM 程序怎么构建，怎么在 NEMU 中运行？<a class="headerlink" href="#3-am-nemu" title="Permanent link">&para;</a></h3>
<p>讲义值得参考的部分：<a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2023/2.3.html#rtfsc3">https://nju-projectn.github.io/ics-pa-gitbook/ics2023/2.3.html#rtfsc3</a> </p>
<p>可以问一个更加具体的问题：在<code>am-kernels/kernels/hello/</code> 下运行 <code>make ARCH=$ISA-nemu run</code>，make 到底做了些什么呢？</p>
<p>先看 AM 程序是怎么构建的吧。看 AM 的 Makefile 源文件，我可以看出来编译和链接的代码，并且可以根据 <code>ARCH</code> 这个命令行参数来选择不同的架构。选择的架构不同，就会选择不同的交叉编译工具，编译不同架构的代码。如果选择的架构是<code>native</code>，就直接用 gcc 编译成 <code>x86</code> 类型的文件，可以直接在 linux 主机上运行；如果选择的是<code>riscv32-nemu</code>，就会用riscv64-linux-gnu-gcc 来编译，并进行进一步处理，来使得程序可以在 nemu 上运行。</p>
<details class="小问题" open="open">
<summary>小问题</summary>
<p>问题：我目前还没有搞清楚在 Makefile 中怎么规定编译链接的顺序。</p>
<p>勉强答：编译的先后顺序无所谓，链接的顺序是 ld 根据链接脚本 <code>abstract-machine/scripts/linker.ld</code> 来链接，but 这个文件我还是看不懂。</p>
</details>
<details class="交叉编译" open="open">
<summary>交叉编译</summary>
<p>什么是交叉编译呢？在一个平台上将代码编译成另一个平台的程序就叫交叉编译。比如我们这里，就是在 <code>x86</code> 的 linux 平台下把代码编译成 <code>riscv32</code> 类型的文件。</p>
</details>
<p>如果要搞清楚 make 在做什么的话，可以利用 make 的 -n 选项来查看运行 make 会执行哪些命令。这里我们运行</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>make -n ARCH=riscv32-nemu run
</code></pre></div>
<p>输出的结果很长，我就不放了。
做的事情概括起来是：</p>
<ol>
<li>gcc 将 AM 实现源文件编译成目标文件，用 ar 将目标文件打包成一个库</li>
<li>通过 gcc 和 ar 将 klib 的实现编译打包成库</li>
<li>gcc 把应用程序源文件 <code>hello.c</code> 编译成目标文件</li>
<li>用 ld 根据链接脚本 <code>abstract-machine/scripts/linker.ld</code>, 将上述目标文件和归档文件链接成可执行文件，<code>*.bin</code>是镜像文件，将加载到 nemu 中运行，<code>*.elf</code> 是对应的 16 进制文件，我们可以读取它获得相应的信息。</li>
<li>run 选项对应的代码是 <code>$(MAKE)i-C $(NEMU_HOME) ISA=$(ISA) run ARGS="$(NEMUFLAGS)" IMG=$(IMAGE).bin</code>。很简单，是在 nemu 的主文件夹下编译构建出 nemu interpreter，并运行它。</li>
</ol>
<p>接着，nemu 运行它的应用程序的过程：</p>
<ol>
<li>打开 nemu 以后，nemu 在初始化的过程中会将即将执行的应用程序的镜像文件 (*.bin) 加载到内存 (pmem) 中。</li>
<li>开始运行程序后，第一条指令从 <code>abstract-machine/am/src/$ISA/nemu/start.S</code> 开始, 设置好栈顶之后就跳转到 <code>abstract-machine/am/src/platform/nemu/trm.c</code> 的 <code>_trm_init()</code> 函数处执行.</li>
<li>在 <code>_trm_init()</code>中调用 <code>main()</code> 函数执行程序的主体功能</li>
<li>从 <code>main()</code> 函数返回后, 调用 <code>halt()</code> 结束运行</li>
</ol>
<details class="小问题" open="open">
<summary>小问题</summary>
<p>问题：编译构建 nemu 项目时，最后的项目名称 <code>nemu-intepreter</code> 哪里来的？我还没搞清楚。</p>
</details>
<h3 id="4-io">4. IO 设备<a class="headerlink" href="#4-io" title="Permanent link">&para;</a></h3>
<p>NEMU 是怎么实现输入输出设备的模拟的？</p>
<p>看一看源码，一个设备是怎么注册的。首先规定好设备的大小，给设备接口分配一个所需的大小的空间（用 malloc 即可），然后规定好设备的映射地址，以及相应的回调函数，最后将空间、地址和函数等信息通过初始化函数存储起来，就完成了注册。</p>
<p>如果我注册了一个设备，当我访问这段物理地址的时候，就会跳转到对应 I/O 设备地址（就是上面 malloc 分配的额外的空间，而不再是 pmem 内存中了）。当我对这段地址读写时，可能会触发相应的回调函数，回调函数就是这个设备的“动作”了。比如串口的回调函数，就是打印写入的字符到标准错误流中。</p>
<p>更具体的，就 RTFSC 吧，源代码还是比较清楚的，讲义也很详细了： <a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2023/2.5.html">https://nju-projectn.github.io/ics-pa-gitbook/ics2023/2.5.html</a></p>
<h4 id="_18">声卡<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>最麻烦的就是声卡，需要软件硬件协同操作。</p>
<p>但是学到的也最多，实现了声卡了以后，理解就更深刻，在 AM 中寄存器的操作都还是软件层，AM 就是软件和硬件的桥梁，将相应的数据写到对应的内存中，然后硬件（NEMU）再进行处理，进行声音的播放。看到完整的 bad apple 还怪高兴的哈哈。</p>
<p>打开声卡前，最好关闭 trace 功能。</p>
<p>声卡很吃配置，打开声卡以后，超级玛丽完全玩不了了。（显卡还有十几帧的）。</p>
<p>另外，不要老是挂起虚拟机。正常的指令执行速度是每秒两千万条，有的时候性能降低到每秒八万条，打字都卡，就赶紧关机重启吧。</p>
<p>二次元是这样的：
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>................................................................................
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>..............................................X.X.X.............................
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>.............................................XXXXXXXXX..........................
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>..............................................XXXXXXXXX.XXXXX...................
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>............................................XXXXXXXXXXXXXXXXXXX.................
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>........................................X.XXXXXXXXXXXXXXXXXXXXX.................
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>........................................XXXXXXXXXXXXXXXXXXXXXXXX................
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>........................................XXXXXXXXXXXXXXXXXXXXXXXXX...............
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>.......................................XXXXXXXXXXXXXXXXXXXXXXXXXXX..............
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>........................................XXXXXXXXXXXXXXXXXXXXXXXXXXX.............
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>...........................................XXXXXXXXXXXXXXXXXXXXXXXX.............
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>............................................XXXXXXXXXXXXXXXXXXXXXXX.............
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>.............................................XXXXXXXXXXXXXXXXXXXXXX.............
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>..............................................XXX.XXXXXXXXXXXXXXXXX.............
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>..............................................XXXXXXXXXXXXXXXXXXXXXX............
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>........................X.X.X.X...............XXXXXXXXXXXXXXXXX.X.X.............
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>.......................XXXXXXXXX...............XXXXXXXXXXXXXXXX.................
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>......................XXXXXXXXXXX...........X.XXXXXXXXXXXXXXX.X.................
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>.......................XXXXXXXXXXX.X.......XXXXXXXXXXXXXXXXXXX..................
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>........................XXXXXXXXXXXXXXX.X.XXXXXXXXXXXXXXXXXXXX..................
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>.............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..................
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...X.X...........
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>.............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.X............
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...............
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..............
</code></pre></div></p>
<h3 id="5">5. 杂项<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<p>ftrace 真的是要老命了，纯苦力活。</p>
<p>读取 ELF 文件？问互联网、问手册、问 GPT 吧。</p>
<p>怎么判断 riscv 中何时 call、何时 ret？call 和 ret 都会离开当前函数体。先判断 call，如果下一条指令地址是一个函数头，就一定是 call，反之就是 ret。</p>
<p>而且做完以后还引入一个新 bug：我关闭调试信息选项以后，编译不通过了是几个意思？？？（其实可以理解，因为关闭调试选项意味着没有了任何信息，导致读入的都是无效的字符，所以导致编译器报未初始化警告）</p>
<p>想尽可能把实验的记录写清楚点，但是真的太花精力了，睡觉！</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-12-10</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-11-02</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/peter5723/peter5723.github.io" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>